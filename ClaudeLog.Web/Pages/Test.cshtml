@page
@model TestModel
@{
    ViewData["Title"] = "API Testing";
}

<div class="container-fluid py-4">
    <div class="row mb-3">
        <div class="col">
            <h2>ClaudeLog API Testing</h2>
            <p class="text-muted">Test all API endpoints easily</p>
            <div class="d-flex gap-2">
                <a href="/" class="btn btn-sm btn-outline-primary">‚Üê Back to Home</a>
            </div>
        </div>
    </div>

    <!-- Response Display Area -->
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <span>Response</span>
                    <button class="btn btn-sm btn-light" onclick="clearResponse()">Clear</button>
                </div>
                <div class="card-body">
                    <pre id="responseDisplay" class="mb-0" style="max-height: 300px; overflow-y: auto; background-color: #f8f9fa; padding: 1rem; border-radius: 0.25rem;">No requests made yet...</pre>
                </div>
            </div>
        </div>
    </div>

    <!-- API Test Forms -->
    <div class="row">
        <!-- Sections API -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Sections API</h5>
                </div>
                <div class="card-body">
                    <!-- Create Section -->
                    <h6 class="border-bottom pb-2">POST /api/sections</h6>
                    <form id="createSectionForm" class="mb-4">
                        <div class="mb-2">
                            <label class="form-label">Tool Name</label>
                            <input type="text" class="form-control form-control-sm" id="sectionTool" value="TestTool" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Section ID (optional GUID)</label>
                            <input type="text" class="form-control form-control-sm" id="sectionId" placeholder="Leave empty to auto-generate">
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Create Section</button>
                    </form>

                    <!-- Get Sections -->
                    <h6 class="border-bottom pb-2">GET /api/sections</h6>
                    <form id="getSectionsForm" class="mb-4">
                        <div class="mb-2">
                            <label class="form-label">Days</label>
                            <input type="number" class="form-control form-control-sm" id="sectionDays" value="30">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Page</label>
                            <input type="number" class="form-control form-control-sm" id="sectionPage" value="1">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Page Size</label>
                            <input type="number" class="form-control form-control-sm" id="sectionPageSize" value="50">
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Get Sections</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Entries API -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Entries API</h5>
                </div>
                <div class="card-body">
                    <!-- Create Entry -->
                    <h6 class="border-bottom pb-2">POST /api/entries</h6>
                    <form id="createEntryForm" class="mb-4">
                        <div class="mb-2">
                            <label class="form-label">Section ID (GUID)</label>
                            <input type="text" class="form-control form-control-sm" id="entrySectionId" required placeholder="Paste section ID here">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Question</label>
                            <textarea class="form-control form-control-sm" id="entryQuestion" rows="2" required>How do I test the API?</textarea>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Response</label>
                            <textarea class="form-control form-control-sm" id="entryResponse" rows="3" required>You can test the API using this test page. Just fill in the forms and click the buttons!</textarea>
                        </div>
                        <button type="submit" class="btn btn-success btn-sm">Create Entry</button>
                    </form>

                    <!-- Get Entries -->
                    <h6 class="border-bottom pb-2">GET /api/entries</h6>
                    <form id="getEntriesForm" class="mb-4">
                        <div class="mb-2">
                            <label class="form-label">Search</label>
                            <input type="text" class="form-control form-control-sm" id="entrySearch" placeholder="Optional search term">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Page</label>
                            <input type="number" class="form-control form-control-sm" id="entryPage" value="1">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Page Size</label>
                            <input type="number" class="form-control form-control-sm" id="entryPageSize" value="10">
                        </div>
                        <button type="submit" class="btn btn-success btn-sm">Get Entries</button>
                    </form>

                    <!-- Get Entry By ID -->
                    <h6 class="border-bottom pb-2">GET /api/entries/{id}</h6>
                    <form id="getEntryByIdForm" class="mb-4">
                        <div class="mb-2">
                            <label class="form-label">Entry ID</label>
                            <input type="number" class="form-control form-control-sm" id="entryGetId" required placeholder="Entry ID">
                        </div>
                        <button type="submit" class="btn btn-success btn-sm">Get Entry By ID</button>
                    </form>

                    <!-- Update Title -->
                    <h6 class="border-bottom pb-2">PATCH /api/entries/{id}/title</h6>
                    <form id="updateTitleForm" class="mb-4">
                        <div class="mb-2">
                            <label class="form-label">Entry ID</label>
                            <input type="number" class="form-control form-control-sm" id="entryUpdateId" required placeholder="Entry ID">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">New Title</label>
                            <input type="text" class="form-control form-control-sm" id="entryNewTitle" required placeholder="New title">
                        </div>
                        <button type="submit" class="btn btn-success btn-sm">Update Title</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Errors API -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">Errors API</h5>
                </div>
                <div class="card-body">
                    <!-- Log Error -->
                    <h6 class="border-bottom pb-2">POST /api/errors</h6>
                    <form id="logErrorForm" class="mb-4">
                        <div class="mb-2">
                            <label class="form-label">Source</label>
                            <input type="text" class="form-control form-control-sm" id="errorSource" value="TestPage" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Message</label>
                            <input type="text" class="form-control form-control-sm" id="errorMessage" value="Test error message" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Detail (optional)</label>
                            <textarea class="form-control form-control-sm" id="errorDetail" rows="2" placeholder="Stack trace or additional details"></textarea>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Path (optional)</label>
                            <input type="text" class="form-control form-control-sm" id="errorPath" placeholder="e.g., /api/test">
                        </div>
                        <button type="submit" class="btn btn-warning btn-sm">Log Error</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <h6 class="border-bottom pb-2">Create Test Data</h6>
                    <p class="small text-muted">Create a section and entry in one click</p>
                    <button class="btn btn-info btn-sm mb-3" onclick="createTestData()">Create Test Section + Entry</button>

                    <h6 class="border-bottom pb-2 mt-4">View in Database</h6>
                    <p class="small text-muted">Quick SQL queries to run in SSMS</p>
                    <div class="small">
                        <code class="d-block bg-light p-2 mb-2 rounded">SELECT * FROM Sections ORDER BY CreatedAt DESC</code>
                        <code class="d-block bg-light p-2 mb-2 rounded">SELECT * FROM Conversations ORDER BY CreatedAt DESC</code>
                        <code class="d-block bg-light p-2 rounded">SELECT * FROM ErrorLogs ORDER BY CreatedAt DESC</code>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/js/test.js"></script>
